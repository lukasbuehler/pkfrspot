<div class="map-container" *ngIf="mapsService.isApiLoaded$ | async">
  <google-map
    #map
    id="map"
    [center]="start_coordinates"
    [zoom]="start_zoom"
    [options]="mapOptions"
    [mapTypeId]="mapTypeId"
    (mapClick)="clickedMap($event)"
    (boundsChanged)="boundsChanged()"
    (centerChanged)="centerChanged()"
    (zoomChanged)="zoomChanged()"
    width="100%"
    height="100%"
  >
    <map-marker
      *ngFor="let dot of visibleDots"
      iconUrl="/assets/icons/favicon-16x16.png"
      [latitude]="dot.location.latitude"
      [longitude]="dot.location.longitude"
      [markerDraggable]="false"
      [opacity]="zoomDotOpacity"
    ></map-marker>

    <map-circle
      *ngFor="let spot of visibleSpots"
      [fillColor]="'#304ffe'"
      [latitude]="spot.location.lat"
      [longitude]="spot.location.lng"
      [circleDraggable]="false"
      [strokeWeight]="0"
      [strokeOpacity]="0"
      [radius]="5"
      [visible]="true"
      [fillOpacity]="0.75"
      (circleClick)="openSpot(spot)"
    >
      <map-polygon
        *ngIf="selectedSpot?.hasBounds()"
        #polygon
        [paths]="spot.paths"
        [fillColor]="'#304ffe'"
        [strokeColor]="'#304ffe'"
        [fillOpacity]="0.1"
        [editable]="
          isEditing && spot && selectedSpot && spot.id === selectedSpot.id
        "
        (polyClick)="openSpot(spot)"
      ></map-polygon>
    </map-circle>

    <agm-marker
      *ngIf="selectedSpot"
      [agmFitBounds]="true"
      [latitude]="selectedSpot.location.lat"
      [longitude]="selectedSpot.location.lng"
      [title]="selectedSpot.name"
      iconUrl="/assets/icons/marker.png"
      [markerDraggable]="isEditing"
      [markerClickable]="true"
      (dragEnd)="spotMarkerMoved($event)"
    ></agm-marker>
  </google-map>

  <button
    mat-mini-fab
    #mapStyleFab
    color="white"
    id="mapStyleFab"
    (click)="toggleMapStyle()"
  >
    <mat-icon aria-label="Button with magnifying lens to search for spots">
      {{ mapOptions.mapTypeId === "ROADMAP" ? "terrain" : "map" }}
    </mat-icon>
  </button>

  <!-- Add / import spots speed dial-->
  <app-speed-dial-fab
    *ngIf="authService.isSignedIn && !isEditing"
    #createSpotSpeedDial
    id="createSpotSpeedDial"
    [buttonConfig]="speedDialButtonConfig"
    [openOnHover]="true"
    [rotationDegrees]="0"
    (mainFabClick)="mainFabClicked()"
    (miniFabClick)="miniFabPressed($event)"
  ></app-speed-dial-fab>
</div>
